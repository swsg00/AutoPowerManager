#!/system/bin/sh

# AutoPowerManager 启动脚本
# 确保系统应用服务在启动时自动运行

echo "Starting AutoPowerManager service..."

# 等待系统完全启动
count=0
while [ $count -lt 60 ]; do
    if [ -d "/system/priv-app" ] && [ -f "/system/priv-app/AutoPowerManager/AutoPowerManager.apk" ]; then
        break
    fi
    sleep 1
    count=$((count + 1))
done

# 启动服务
am startservice --user 0 -a android.intent.action.BOOT_COMPLETED -n com.oppo.autopower/.AutoPowerService

# 设置权限
chmod 600 /data/system/autopower_timer_config.prop
chown system:system /data/system/autopower_timer_config.prop
chmod 600 /data/system/autopower_service_status.prop
chown system:system /data/system/autopower_service_status.prop

echo "AutoPowerManager service started successfully"

# 创建安全检查文件
mkdir -p /data/system/
touch /data/system/.autopower_secure
chmod 600 /data/system/.autopower_secure
chown system:system /data/system/.autopower_secure